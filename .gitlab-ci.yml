stages:
  - update
  - test

default:
  image: "cirrusci/flutter:latest"

update_flutter:
  stage: update
  script:
    - flutter clean
    - flutter pub get
  interruptible: true

code_quality:
  stage: test
  before_script:
    - pub global activate dart_code_metrics
    - export PATH="$PATH":"$HOME/.pub-cache/bin"
  script:
    - metrics lib -r codeclimate  > gl-code-quality-report.json
  artifacts:
    reports:
      codequality: gl-code-quality-report.json

unit_test:
  stage: test
  script:
    - flutter test test/unit_test
  interruptible: true

widget_test:
  stage: test
  script:
    - flutter test test/widget_test
  interruptible: true
